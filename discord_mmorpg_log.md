# Discord MMORPG 개발 로그

## 백업 정책

- **시점:** 주요 기능 추가, 데이터베이스 스키마 변경 등 **중요한 변경 작업이 완료된 직후**에 백업을 생성합니다.
- **형식:** `discord_mmorpg_backup_YYYYMMDD_HHMM.zip` 과 같이 날짜와 시간까지 포함하여 버전을 관리합니다.
- **범위:** 코드와 데이터베이스 파일(`game.db`)을 포함한 프로젝트 폴더 전체를 압축합니다.
- **조건:** 사용자가 **안해도 돼**라는 말을 **했다면**백업을 안하여도 됩니다.

---

## 2025년 7월 28일

### 맵 시스템 구현

- **데이터베이스 구조 확장:**
  - `locations` 테이블: 맵의 각 지역 정보(이름, 설명)를 저장합니다.
  - `map_connections` 테이블: 지역 간의 이동 경로를 정의합니다.
  - `location_monsters` 테이블: 지역별로 출현하는 몬스터를 지정합니다.
  - `players` 테이블: `current_location_id` 열을 추가하여 플레이어의 현재 위치를 추적합니다.
  - `database.py`에 초기 맵 데이터(평온한 초원, 동쪽 숲, 오래된 폐허)와 연결 정보를 추가했습니다.

- **맵 관련 명령어 추가 (`game_cog.py`):**
  - `/주변`: 현재 위치의 설명과 함께 이동 가능한 지역 목록을 표시합니다.
  - `/이동 [목적지]`: 다른 지역으로 이동합니다. 이동 가능한 목적지는 자동 완성으로 편리하게 선택할 수 있습니다.

- **기존 기능 연동:**
  - `/탐험`: 이제 플레이어의 현재 위치에 따라 `location_monsters` 테이블에 정의된 몬스터가 출현하도록 수정했습니다.
  - `/내정보`: 플레이어 정보에 현재 위치 이름이 함께 표시되도록 개선했습니다.
  - **로그인**: 새로운 플레이어나 기존 플레이어가 로그인하면 기본 시작 위치인 "평온한 초원"에서 시작하도록 설정했습니다.

### 핵심 게임 루프 구현: 탐험 및 전투

- **게임 콘텐츠 추가를 위한 기반 마련**
  - `game_cog.py` 파일을 생성하여 게임 플레이 관련 명령어(탐험, 전투 등)를 분리할 수 있는 구조를 만들었습니다.
  - Cog가 로드될 때 `players` 데이터베이스 테이블에 `exp` (경험치) 열을 자동으로 추가하도록 `setup` 함수를 구현했습니다.

- **핵심 게임 루프 구현: 탐험 및 전투**
  - `/탐험` 명령어를 추가하여 플레이어가 미지의 지역을 탐험할 수 있게 했습니다.
    - 탐험 시 일정 확률로 몬스터와 조우하거나, 아무 일도 일어나지 않거나, 아이템을 발견하는 등 다양한 이벤트가 발생합니다.
  - 턴제 전투 시스템의 기초를 구현했습니다.
    - 몬스터 조우 시, 플레이어는 '공격'과 '도망'을 선택할 수 있는 버튼 UI를 받게 됩니다.
    - **공격**: 플레이어와 몬스터가 서로 데미지를 주고받으며, 결과는 '게임 정보' 임베드에 실시간으로 업데이트됩니다.
    - **전투 종료**: 몬스터를 처치하면 골드와 경험치를 보상으로 획득하며, 패배 시에는 최소한의 HP를 남기고 부활합니다. (추후 패널티 강화 예정)
    - **도망**: 현재는 100% 확률로 전투에서 벗어날 수 있습니다.

- **코드 구조 개선**
  - `main.py`의 `on_ready` 이벤트 핸들러에 `game_cog`를 로드하는 코드를 추가하여 모듈화된 구조를 유지했습니다.

## 2025년 8월 4일

### 제작 시스템 및 내구도 시스템 기반 구현

- **신규 아이템 및 레시피 추가:**
  - `database.py`에 제작 재료('나뭇가지', '질긴 나뭇잎')와 제작 아이템('낡은 낚싯대', '튼튼한 낚싯대', '돌 칼')을 추가했습니다.
  - `game_cog.py`에 각 아이템의 제작법(recipe)을 정의했습니다.

- **재료 획득 로직 추가:**
  - `/행동` 명령어의 '덤불 살피기'를 통해 '나뭇가지'를, '나무 올라가기' 실패 시 '질긴 나뭇잎'을 획득할 수 있도록 수정했습니다.

- **/제작 명령어 구현:**
  - `/제작` 명령어를 추가하여 플레이어가 재료를 소모해 아이템을 만들 수 있는 기능을 구현했습니다.
  - 제작 가능한 아이템 목록은 자동 완성으로 편리하게 선택할 수 있습니다.

- **내구도 시스템 데이터베이스 연동:**
  - `database.py`의 `items` 테이블에 `max_durability` 열을, `player_inventory` 테이블에 `durability` 열을 추가하여 내구도 시스템의 기반을 마련했습니다.
  - `game_cog.py`의 `/인벤토리` 명령어에 아이템의 현재 내구도가 표시되도록 수정했습니다.

- **내구도 감소 로직 구현:**
  - `/행동` 명령어를 통해 '낚시'나 '채광'을 할 때마다 사용하는 도구의 내구도가 1씩 감소하도록 구현했습니다.
  - 내구도가 0이 된 아이템은 인벤토리에서 자동으로 파괴됩니다.

- **오류 수정 및 안정성 강화:**
  - `database is locked` 오류를 해결하기 위해 `/제작` 명령어의 데이터베이스 트랜잭션 처리 방식을 개선했습니다.
  - `NoneType` 오류를 방지하기 위해, 내구도가 없는 아이템을 처음 사용할 때 최대 내구도로 자동 설정하는 로직을 추가했습니다.
  - `/행동` 명령어의 상호작용 응답 처리 로직을 수정하여 '생각 중' 오류를 해결했습니다.

### 다음 단계 계획

- 전투 시 무기 내구도 감소 기능 구현
- 장비 장착/해제 시스템 구현
- 수리 시스템 구현 (필요 시)
- 제작 가능한 아이템 종류 확장
